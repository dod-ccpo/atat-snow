<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_ws_operation">
    <sys_ws_operation action="INSERT_OR_UPDATE">
        <active>true</active>
        <consumes>application/json,application/xml,text/xml,multipart/form-data</consumes>
        <consumes_customized>false</consumes_customized>
        <default_operation_uri/>
        <enforce_acl>cf9d01d3e73003009d6247e603f6a990</enforce_acl>
        <http_method>GET</http_method>
        <name>edms-multipart-attachment</name>
        <operation_script><![CDATA[(function process(/*RESTAPIRequest*/ request, /*RESTAPIResponse*/ response) {

  var params = request.queryParams;
  var hostRecord = params.packageId;
  var attachmentId = params.attachmentDocSysId;
  var boundary = params.boundary;

  response.setContentType("text/plain");
  response.setStatus(200);

  // multipart generation using stream writer
  var writer = response.getStreamWriter();

  var classification = '--' + boundary + "\r\n";
  classification += 'Content-Disposition: form-data; name="classification"\r\n\r\n';
  //classification += 'Content-Type: ' + 'text/plain; charset=UTF-8' + '\r\n\r\n';
  classification += 'Pre-Solicitation';
  writer.writeString(classification);

  var docType = '\r\n--' + boundary + "\r\n";
  docType += 'Content-Disposition: form-data; name="documentType"\r\n\r\n';
  //docType += 'Content-Type: ' + 'text/plain;charset=UTF-8' + '\r\n\r\n';
  docType += '003 - Requirements Package Documents (to include Req Checklist, Section 508, IGCE, etc)';
  writer.writeString(docType);

  var indexFields = '\r\n--' + boundary + "\r\n";
  indexFields += 'Content-Disposition: form-data; name="indexFields"\r\n\r\n';
  //indexFields += 'Content-Type: ' + 'text/plain;charset=UTF-8' + '\r\n\r\n';
	
  // Pre-Solicitation value from Lee who created a 
  // Post Award with the Create All Levels set to true 
  // and was able to use the API to upload documents to it
  // result -> 200 resopnse
  indexFields += JSON.stringify([
    { name: "Description", value: "Requirements Checklist, to include Section 508" },
    { name: "Pre-Solicitation", value: "IT221117LBPM03A" }
  ]);
  //indexFields += "[{\"name\":\"Description\",\"value\":\"Requirements Checklist, to include Section 508\"},{\"name\":\"Pre-Solicitation\",\"value\":\"testPostAwardId\"}]";
  writer.writeString(indexFields);

  var fileName = '\r\n--' + boundary + "\r\n";
  fileName += 'Content-Disposition: form-data; name="fileName"\r\n\r\n';
  //fileName += 'Content-Type: ' + 'text/plain;charset=UTF-8' + '\r\n\r\n';
  fileName += 'Requirements-Checklist.pdf';
  writer.writeString(fileName);

  var file = '\r\n--' + boundary + "\r\n";
  file += 'Content-Disposition: form-data; name="file"\r\n';
  file += 'Content-Type: ' + 'application/octet-stream' + '\r\n\r\n';
  //file += 'Content-Transfer-Encoding: Base64' + "\r\n\r\n";
  writer.writeString(file);

  var attachmentContent = new GlideSysAttachment().getContentStream(attachmentId);
  writer.writeStream(attachmentContent);

  //var attachmentContent = "JVBERi0xLjMKMyAwIG9iago8PC9UeXBlIC9QYWdlCi9QYXJlbnQgMSAwIFIKL1Jlc291cmNlcyAyIDAgUgovQ29udGVudHMgNCAwIFI+PgplbmRvYmoKNCAwIG9iago8PC9GaWx0ZXIgL0ZsYXRlRGVjb2RlIC9MZW5ndGggNzI+PgpzdHJlYW0KeJwzUvDiMtAzNVco53IKUdB3M1QwNNMzMFAISVNwDQEJGRvqGVoqmFuagBSFpChoeKTm5OQrhOcX5aQoaiqEZIHUAQAXNxBXCmVuZHN0cmVhbQplbmRvYmoKMSAwIG9iago8PC9UeXBlIC9QYWdlcwovS2lkcyBbMyAwIFIgXQovQ291bnQgMQovTWVkaWFCb3ggWzAgMCA1OTUuMjggODQxLjg5XQo+PgplbmRvYmoKNSAwIG9iago8PC9UeXBlIC9Gb250Ci9CYXNlRm9udCAvSGVsdmV0aWNhLUJvbGQKL1N1YnR5cGUgL1R5cGUxCi9FbmNvZGluZyAvV2luQW5zaUVuY29kaW5nCj4+CmVuZG9iagoyIDAgb2JqCjw8Ci9Qcm9jU2V0IFsvUERGIC9UZXh0IC9JbWFnZUIgL0ltYWdlQyAvSW1hZ2VJXQovRm9udCA8PAovRjEgNSAwIFIKPj4KL1hPYmplY3QgPDwKPj4KPj4KZW5kb2JqCjYgMCBvYmoKPDwKL1Byb2R1Y2VyIChQeUZQREYgMS43LjIgaHR0cDovL3B5ZnBkZi5nb29nbGVjb2RlLmNvbS8pCi9DcmVhdGlvbkRhdGUgKEQ6MjAyMjExMTYxMzE1MTApCj4+CmVuZG9iago3IDAgb2JqCjw8Ci9UeXBlIC9DYXRhbG9nCi9QYWdlcyAxIDAgUgovT3BlbkFjdGlvbiBbMyAwIFIgL0ZpdEggbnVsbF0KL1BhZ2VMYXlvdXQgL09uZUNvbHVtbgo+PgplbmRvYmoKeHJlZgowIDgKMDAwMDAwMDAwMCA2NTUzNSBmIAowMDAwMDAwMjI4IDAwMDAwIG4gCjAwMDAwMDA0MTYgMDAwMDAgbiAKMDAwMDAwMDAwOSAwMDAwMCBuIAowMDAwMDAwMDg3IDAwMDAwIG4gCjAwMDAwMDAzMTUgMDAwMDAgbiAKMDAwMDAwMDUyMCAwMDAwMCBuIAowMDAwMDAwNjI5IDAwMDAwIG4gCnRyYWlsZXIKPDwKL1NpemUgOAovUm9vdCA3IDAgUgovSW5mbyA2IDAgUgo+PgpzdGFydHhyZWYKNzMyCiUlRU9GCg==";
  //writer.writeString(attachmentContent);
	
  var multipartEnd = '\r\n--' + boundary + '--\r\n';
  writer.writeString(multipartEnd);


})(request, response);]]></operation_script>
        <operation_uri>/api/x_g_dis_atat/edms/edms-multipart-attachment</operation_uri>
        <produces>application/json,application/xml,text/xml,multipart/form-data</produces>
        <produces_customized>false</produces_customized>
        <relative_path>/edms-multipart-attachment</relative_path>
        <request_example/>
        <requires_acl_authorization>true</requires_acl_authorization>
        <requires_authentication>true</requires_authentication>
        <requires_snc_internal_role>true</requires_snc_internal_role>
        <short_description/>
        <sys_class_name>sys_ws_operation</sys_class_name>
        <sys_created_by>julius.fitzhugh-ctr</sys_created_by>
        <sys_created_on>2022-10-31 06:00:31</sys_created_on>
        <sys_id>95dead32977611106fa8b4b3f153af05</sys_id>
        <sys_mod_count>41</sys_mod_count>
        <sys_name>edms-multipart-attachment</sys_name>
        <sys_package display_value="ATAT" source="x_g_dis_atat">f600233d1b154d507b782f84604bcb12</sys_package>
        <sys_policy/>
        <sys_scope display_value="ATAT">f600233d1b154d507b782f84604bcb12</sys_scope>
        <sys_update_name>sys_ws_operation_95dead32977611106fa8b4b3f153af05</sys_update_name>
        <sys_updated_by>1608268967.CTR</sys_updated_by>
        <sys_updated_on>2022-11-18 14:26:08</sys_updated_on>
        <web_service_definition display_value="EDMS">a4ae657e973611106fa8b4b3f153aff7</web_service_definition>
        <web_service_version/>
    </sys_ws_operation>
</record_update>
