<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_script_include">
    <sys_script_include action="INSERT_OR_UPDATE">
        <access>package_private</access>
        <active>true</active>
        <api_name>x_g_dis_atat.MarketResearchReport</api_name>
        <caller_access/>
        <client_callable>false</client_callable>
        <description/>
        <name>MarketResearchReport</name>
        <script><![CDATA[var MarketResearchReport = Class.create();
MarketResearchReport.prototype = {

    acquisitionPackage: null,
    janda: null,
    fairOpportunity: new GlideRecord("x_g_dis_atat_fair_opportunity"),
    DATA_INCOMPLETE: 4001,
    UNEXPECTED_ERROR: 5001,

    initialize: function(acqPackage) {
        this.acquisitionPackage = acqPackage;
        this.janda = new JustificationAndApproval(acqPackage);
        this.constructError = this.janda.constructError;
        this.explicitNull = this.janda.explicitNull;

        this.requirementsChecklist = new RequirementsChecklist(acqPackage);

        // Look up Fair Opportunity record
        this.fairOpportunity.get(this.acquisitionPackage.fair_opportunity);
        if (!this.fairOpportunity.sys_id) {
            throw this.constructError(this.DATA_INCOMPLETE, "No Fair Opportunity record found");
        }

    },

    explicitNull: function(value) {
        return value ? value : null;
    },

    getPayload: function() {

        // Static impl from sample data to start
        // TODO make dynamic

        var researchers = [{
                name: "Jane Researcher",
                title: "Head researcher",
                organization: "FEMA",
            },
            {
                name: "John Researcher",
                title: "Assistant researcher",
                organization: "FEMA",
            },
        ];

        // The research techniques used is stored in in Fair Opportunity.research_other_techniques_used; a List that references table x_g_dis_atat_dapps_market_research_other_techniques
        // When value OTHER is included in the above list use Fair Opportunity.research_other_technique
        // When value PERSONAL_KNOWLEDGE is included in the above list that's when Fair Opportunity.research_personal_knowledge_person_or_position is needed

        var techniquesUsed = [{
            type: "PERSONAL_KNOWLEDGE"
        }, {
            type: "CONTACT_WITH_KNOWLEDGEABLE_PERSON"
        }, {
            type: "OTHER"
        }];

        var summaryOfMarketResearch = "My research details incredible findings from speaking to two leading experts.";

        // TODO this.janda.getPoc(some poc in schema.toString())
        var primaryPoc = {
            formalName: "Maria Missionowner",
            phoneAndExtension: "+1 (555) 123-4567",
            title: "Project Lead",
        };

        var corPoc = {
            formalName: "Cary Conofficer",
            phoneAndExtension: "+1 (555) 987-6543",
            title: "Contracting Officer",
        };

        var jandaPayload = this.janda.getPayload();

        return {
            documentType: "MARKET_RESEARCH_REPORT",
            templatePayload: {
                researchers: researchers,
                fairOpportunity: jandaPayload.templatePayload.fairOpportunity,
                techniquesUsed: techniquesUsed,
                techniqueOther: this.explicitNull(this.fairOpportunity.research_other_technique.toString()),
                title: jandaPayload.templatePayload.title,
                estimatedValue: jandaPayload.templatePayload.estimatedValue,
                estimatedValueFormatted: jandaPayload.templatePayload.estimatedValueFormatted,
                summaryOfMarketResearch: summaryOfMarketResearch,
                procurementHistory: jandaPayload.templatePayload.procurementHistory,
                primaryPoc: primaryPoc,
                corPoc: corPoc,
                agencyLabel: jandaPayload.templatePayload.agencyLabel,
                researchPersonalKnowledgePersonOrPosition: this.explicitNull(this.fairOpportunity.research_personal_knowledge_person_or_position.toString()),
            }
        };
    },

    type: 'MarketResearchReport'
};]]></script>
        <sys_class_name>sys_script_include</sys_class_name>
        <sys_created_by>jason.d.burkert.ctr@mail.mil</sys_created_by>
        <sys_created_on>2023-05-26 18:50:51</sys_created_on>
        <sys_id>da81226197072110cf3cfd9fe153afee</sys_id>
        <sys_mod_count>17</sys_mod_count>
        <sys_name>MarketResearchReport</sys_name>
        <sys_package display_value="ATAT" source="x_g_dis_atat">f600233d1b154d507b782f84604bcb12</sys_package>
        <sys_policy>read</sys_policy>
        <sys_scope display_value="ATAT">f600233d1b154d507b782f84604bcb12</sys_scope>
        <sys_update_name>sys_script_include_da81226197072110cf3cfd9fe153afee</sys_update_name>
        <sys_updated_by>jason.d.burkert.ctr@mail.mil</sys_updated_by>
        <sys_updated_on>2023-05-29 21:45:53</sys_updated_on>
    </sys_script_include>
</record_update>
